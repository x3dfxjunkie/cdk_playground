stack_extension: &se cme-wdw # 12 Character Limit!
ingest_pattern: &ip dms # DO NOT UPDATE must = dms for dms pattern
active: True
feature_branch: False # set to False unless you want to deploy DMS in ephemeral envs
pattern_instances:
  - region: &region-1 us-east-1 # DO NOT UPDATE
    resources:
      kinesis_dmz:
        retention_period: &kdr !!python/object/apply:app.src.reliability.Guest360YamlHandler.aws_cdk.aws_kinesis.days_retention
          - 30
        stream_mode: &ksm !!python/object/apply:aws_cdk.aws_kinesis.StreamMode
          - ON_DEMAND
      kinesis:
        retention_period: *kdr
        stream_mode: *ksm
      dms_repl_instance:
        engine_version: "3.5.1"
        multi_az: True
      dms_repl_task: # AWS DMS replication task
        - &replication_task_definitions
          replication_task_identifier: ful1 # An identifier for the replication task. Constraints: - combination of stack_extension (line 1) + task identifier cannot exceed 16 alphanumeric characters or hyphens. - First character must be a letter. - Cannot end with a hyphen or contain two consecutive hyphens
          source_endpoint_arn: source_arn # placeholder only - DO NOT UPDATE, ARN that uniquely identifies the source endpoint.
          target_endpoint_arn: target_arn # placeholder only - DO NOT UPDATE, ARN that uniquely identifies the target endpoint.
          replication_instance_arn: instance_arn # placeholder only - DO NOT UPDATE, ARN of a replication instance.
          replication_task_settings: '{"Logging": {"EnableLogging": true}, "TargetMetadata": {"ParallelLoadThreads": 10, "ParallelLoadBufferSize": 500, "ParallelApplyThreads": 10, "ParallelApplyBufferSize": 500, "ParallelApplyQueuesPerThread": 10}}'
          migration_type: full-load # The migration type. Valid values: full-load | cdc | full-load-and-cdc.
          table_mappings: # The table mappings for the task, several types of rules to specify the data source, source schema, data, and any transformations that should occur during the task
            rules:
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "1" # Unique numeric value to identify the rule.
                rule-name: "1" # Unique name to identify the rule.
                rule-action: include # Value that includes or excludes the object or objects selected by the rule. Valid values: include, exclude, explicit
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "awakening"
                  table-name: "%" #Table qualifier
        - <<: *replication_task_definitions # This is an anchor and is repeating what is set in the first task, but allows specific overrides for each of the configuration keys, as shown for the replication_task_identifier and migration_type below
          replication_task_identifier: cdc1
          migration_type: cdc #Valid values: full-load,cdc,full-load-and-cdc
        - <<: *replication_task_definitions # This is an anchor and is repeating what is set in the first task, but allows specific overrides for each of the configuration keys, as shown for the replication_task_identifier and migration_type below
          replication_task_identifier: low #Low volume tables needing data for Contract Creation
          migration_type: full-load #Valid values: full-load,cdc,full-load-and-cdc
          table_mappings:
            rules:
              - &low_rule_definitions
                rule-type: selection
                rule-id: "1" # Unique numeric value to identify the rule.
                rule-name: "1"
                rule-action: explicit
                object-locator:
                  schema-name: &low_rule_schema "AWAKENING"
                  table-name: "BATCH_JOB"
              - <<: *low_rule_definitions
                rule-id: "2"
                rule-name: "2"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "BATCH_JOB_DETAIL"
              - <<: *low_rule_definitions
                rule-id: "3"
                rule-name: "3"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "CHECKPOINT_LOCATION"
              - <<: *low_rule_definitions
                rule-id: "4"
                rule-name: "4"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "DESTINATION"
              - <<: *low_rule_definitions
                rule-id: "5"
                rule-name: "5"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "INVENTORY_PRODUCT"
              - <<: *low_rule_definitions
                rule-id: "6"
                rule-name: "6"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "INV_BUCKET"
              - <<: *low_rule_definitions
                rule-id: "7"
                rule-name: "7"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "INV_BUCKET_DATE_TIME"
              - <<: *low_rule_definitions
                rule-id: "8"
                rule-name: "8"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "NODE_ID"
              - <<: *low_rule_definitions
                rule-id: "9"
                rule-name: "9"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "NO_SHOW_RESERVATION"
              - <<: *low_rule_definitions
                rule-id: "10"
                rule-name: "10"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "PARK"
              - <<: *low_rule_definitions
                rule-id: "11"
                rule-name: "11"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "PENALIZATION"
              - <<: *low_rule_definitions
                rule-id: "12"
                rule-name: "12"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "PRODUCT_CATEGORY"
              - <<: *low_rule_definitions
                rule-id: "13"
                rule-name: "13"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "PRODUCT_TYPE_PRODUCT_CATEGORY"
              - <<: *low_rule_definitions
                rule-id: "14"
                rule-name: "14"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "RESERVATION_COMMUNICATION"
              - <<: *low_rule_definitions
                rule-id: "15"
                rule-name: "15"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "RESERVATION_MERGE_BCK"
              - <<: *low_rule_definitions
                rule-id: "16"
                rule-name: "16"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "RESERVATION_NOTE"
              - <<: *low_rule_definitions
                rule-id: "17"
                rule-name: "17"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "RULE_CONSTRAINT"
              - <<: *low_rule_definitions
                rule-id: "18"
                rule-name: "18"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "RULE_GROUP"
              - <<: *low_rule_definitions
                rule-id: "19"
                rule-name: "19"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "RULE_SETTING"
              - <<: *low_rule_definitions
                rule-id: "20"
                rule-name: "20"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "SHEDLOCK"
              - <<: *low_rule_definitions
                rule-id: "21"
                rule-name: "21"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "SWIDS_TO_MERGE"
              - <<: *low_rule_definitions
                rule-id: "22"
                rule-name: "22"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "TICKET_CODE_MAPPING"
              - <<: *low_rule_definitions
                rule-id: "23"
                rule-name: "23"
                object-locator:
                  schema-name: *low_rule_schema
                  table-name: "USERS"
      source_endpoint: # AWS DMS Source Endpoint.
        engine_name: mariadb # The type of engine for the endpoint, depending on the EndpointType value. Valid values : mysql | oracle | mariadb | kinesis
        ssl_mode: verify-ca #Enable Secure Sockets Layer (SSL) mode to use for the SSL connection. Allowed values: verify-ca,verify-full
        settings: # See https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.html
          server_timezone: US/Eastern # #Specifies the time zone for the target MySQL-compatible database, e.g., US/Eastern, US/Pacific, UTC / remove if UTC
          secrets_manager_secret_id: arn:aws:secretsmanager:us-east-1:863175788676:secret:lod-use1-cme-wdw-ca-secret-gEvqxZ #pragma: allowlist secret, The ARN, or display name of the SecretsManagerSecret that contains the MySQL endpoint connection details.
      source_kms_key: 76b30cbf-2f4c-45ad-b391-7ee81c2a793b # Update for the secrets_manager_secret_id kms key
      source_ssl_cert: rds-global-bundle # Update for the appropriate source dms certificate, most AWS DBs will use the rds-global-bundle by default
    data_pipe:
      default_router_database: DEFAULT_ROUTER_LOAD_LANDING # Needs update to appropriate default routing
      data_contracts: # This section needs to be updated for all data contracts for the source
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_destination_source_data_contract
          class_name: CMEWDWDestinationModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: destination
          router_database: &database LOAD_LANDING
          router_schema: &schema LND_CME_WDW
          router_table: DESTINATION
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_park_source_data_contract
          class_name: CMEWDWParkModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: park
          router_database: *database
          router_schema: *schema
          router_table: PARK
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_res_summary_stats_source_data_contract
          class_name: CMEWDWResSummaryStatsModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: res_summary_stats
          router_database: *database
          router_schema: *schema
          router_table: RES_SUMMARY_STATS
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_res_by_dates_stats_source_data_contract
          class_name: CMEWDWResByDatesStatsModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: res_by_dates_stats
          router_database: *database
          router_schema: *schema
          router_table: RES_BY_DATES_STATS
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_res_guest_links_source_data_contract
          class_name: CMEWDWResGuestLinksModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: res_guest_links
          router_database: *database
          router_schema: *schema
          router_table: RES_GUEST_LINKS
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_inv_bucket_date_time_source_data_contract
          class_name: CMEWDWInvBucketDateTimeModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: inv_bucket_date_time
          router_database: *database
          router_schema: *schema
          router_table: INV_BUCKET_DATE_TIME
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_inv_bucket_source_data_contract
          class_name: CMEWDWInvBucketModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: inv_bucket
          router_database: *database
          router_schema: *schema
          router_table: INV_BUCKET
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_reservation_source_data_contract
          class_name: CMEWDWReservationModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: reservation
          router_database: *database
          router_schema: *schema
          router_table: RESERVATION
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_shedlock_source_data_contract
          class_name: CMEWDWShedlockModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: shedlock
          router_database: *database
          router_schema: *schema
          router_table: SHEDLOCK
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_pending_cancel_job_source_data_contract
          class_name: CMEWDWPendingCancelJobModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: pending_cancel_job
          router_database: *database
          router_schema: *schema
          router_table: PENDING_CANCEL_JOB
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_audit_inv_bucket_date_time_source_data_contract
          class_name: CMEWDWAuditInvBucketDateTimeModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: audit_inv_bucket_date_time
          router_database: *database
          router_schema: *schema
          router_table: AUDIT_INV_BUCKET_DATE_TIME
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_inventory_product_source_data_contract
          class_name: CMEWDWInventoryProductModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: inventory_product
          router_database: *database
          router_schema: *schema
          router_table: INVENTORY_PRODUCT
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_node_id_source_data_contract
          class_name: CMEWDWNodeIdModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: node_id
          router_database: *database
          router_schema: *schema
          router_table: NODE_ID
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_product_category_source_data_contract
          class_name: CMEWDWProductCategoryModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: product_category
          router_database: *database
          router_schema: *schema
          router_table: PRODUCT_CATEGORY
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_product_type_product_category_source_data_contract
          class_name: CMEWDWProductTypeProductCategoryModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: product_type_product_category
          router_database: *database
          router_schema: *schema
          router_table: PRODUCT_TYPE_PRODUCT_CATEGORY
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_rule_constraint_source_data_contract
          class_name: CMEWDWRuleConstraintModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: rule_constraint
          router_database: *database
          router_schema: *schema
          router_table: RULE_CONSTRAINT
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_rule_group_source_data_contract
          class_name: CMEWDWRuleGroupModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: rule_group
          router_database: *database
          router_schema: *schema
          router_table: RULE_GROUP
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_rule_setting_source_data_contract
          class_name: CMEWDWRuleSettingModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: rule_setting
          router_database: *database
          router_schema: *schema
          router_table: RULE_SETTING
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_batch_job_source_data_contract
          class_name: CMEWDWBatchJobModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: batch_job
          router_database: *database
          router_schema: *schema
          router_table: BATCH_JOB
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_batch_job_detail_source_data_contract
          class_name: CMEWDWBatchJobDetailModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: batch_job_detail
          router_database: *database
          router_schema: *schema
          router_table: BATCH_JOB_DETAIL
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_reservation_merge_bck_source_data_contract
          class_name: CMEWDWReservationMergeBckModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: reservation_merge_bck
          router_database: *database
          router_schema: *schema
          router_table: RESERVATION_MERGE_BCK
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_swids_to_merge_source_data_contract
          class_name: CMEWDWSwidsToMergeModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: swids_to_merge
          router_database: *database
          router_schema: *schema
          router_table: SWIDS_TO_MERGE
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_ticket_code_mapping_source_data_contract
          class_name: CMEWDWTicketCodeMappingModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: ticket_code_mapping
          router_database: *database
          router_schema: *schema
          router_table: TICKET_CODE_MAPPING
        - data_contract: app.src.data_structures.data_contracts.source.cme_wdw.v0.cme_wdw_users_source_data_contract
          class_name: CMEWDWUsersModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: users
          router_database: *database
          router_schema: *schema
          router_table: USERS