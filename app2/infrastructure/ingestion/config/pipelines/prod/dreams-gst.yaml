stack_extension: &se dreams-gst # 12 Character Limit!
ingest_pattern: &ip dms # DO NOT UPDATE must = dms for dms pattern
active: True
feature_branch: False # set to False unless you want to deploy DMS in ephemeral envs
pattern_instances:
  - region: &region-1 us-east-1 # DO NOT UPDATE
    resources:
      kinesis_dmz:
        stream_mode: !!python/object/apply:aws_cdk.aws_kinesis.StreamMode
          - ON_DEMAND
      kinesis:
        stream_mode: !!python/object/apply:aws_cdk.aws_kinesis.StreamMode
          - ON_DEMAND
        retention_period: &kdr !!python/object/apply:app.src.reliability.Guest360YamlHandler.aws_cdk.aws_kinesis.days_retention
          - 30
      dms_repl_task: # AWS DMS replication task
        - &replication_task_definitions
          replication_task_identifier: ful1 # An identifier for the replication task. Constraints: - combination of stack_extension (line 1) + task identifier cannot exceed 16 alphanumeric characters or hyphens. - First character must be a letter. - Cannot end with a hyphen or contain two consecutive hyphens
          source_endpoint_arn: source_arn # placeholder only - DO NOT UPDATE, ARN that uniquely identifies the source endpoint.
          target_endpoint_arn: target_arn # placeholder only - DO NOT UPDATE, ARN that uniquely identifies the target endpoint.
          replication_instance_arn: instance_arn # placeholder only - DO NOT UPDATE, ARN of a replication instance.
          migration_type: full-load # The migration type. Valid values: full-load | cdc | full-load-and-cdc.
          table_mappings: # The table mappings for the task, several types of rules to specify the data source, source schema, data, and any transformations that should occur during the task
            rules:
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "1" # Unique numeric value to identify the rule.
                rule-name: "1" # Unique name to identify the rule.
                rule-action: include # Value that includes or excludes the object or objects selected by the rule. Valid values: include, exclude, explicit
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "%" #Table qualifier
        - <<: *replication_task_definitions # This is an anchor and is repeating what is set in the first task, but allows specific overrides for each of the configuration keys, as shown for the replication_task_identifier and migration_type below
          replication_task_identifier: cdc1
          migration_type: cdc #Valid values: full-load,cdc,full-load-and-cdc
        - <<: *replication_task_definitions
          replication_task_identifier: low  #Low volume tables needing data for Contract Creation
          migration_type: full-load
          table_mappings:
            rules:
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "1" # Unique numeric value to identify the rule.
                rule-name: "1" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "lctr_typ" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "2" # Unique numeric value to identify the rule.
                rule-name: "2" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "gndr" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "3" # Unique numeric value to identify the rule.
                rule-name: "3" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "phn_dev_typ" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "4" # Unique numeric value to identify the rule.
                rule-name: "4" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "lctr_usg_typ" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "5" # Unique numeric value to identify the rule.
                rule-name: "5" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "sfx" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "6" # Unique numeric value to identify the rule.
                rule-name: "6" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "pty_extnl_src" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "7" # Unique numeric value to identify the rule.
                rule-name: "7" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "pty_rl" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "8" # Unique numeric value to identify the rule.
                rule-name: "8" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "salut" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "9" # Unique numeric value to identify the rule.
                rule-name: "9" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "cntry" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "10" # Unique numeric value to identify the rule.
                rule-name: "10" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "lang" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "11" # Unique numeric value to identify the rule.
                rule-name: "11" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "rgn" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "12" # Unique numeric value to identify the rule.
                rule-name: "12" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "txn_idvl_pty_tkt_demog" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "13" # Unique numeric value to identify the rule.
                rule-name: "13" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "txn_org_pty" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "14" # Unique numeric value to identify the rule.
                rule-name: "14" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "txn_pty_extnl_ref_bkp" #Table qualifier
              - rule-type: selection # See selection rules and actions: https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Tasks.CustomizingTasks.TableMapping.SelectionTransformation.Selections.html
                rule-id: "15" # Unique numeric value to identify the rule.
                rule-name: "15" # Unique name to identify the rule.
                rule-action: explicit # Unique name to identify the rule.
                object-locator: # The name of each schema and table or view to which the rule applies
                  schema-name: "guest"
                  table-name: "mase" #Table qualifier
      source_endpoint: # AWS DMS Source Endpoint.
        engine_name: mariadb # The type of engine for the endpoint, depending on the EndpointType value. Valid values : mysql | oracle | mariadb | kinesis
        ssl_mode: verify-ca #Enable Secure Sockets Layer (SSL) mode to use for the SSL connection. Allowed values: verify-ca,verify-full
        settings: # See https://docs.aws.amazon.com/dms/latest/userguide/CHAP_Source.html
#          server_timezone: US/Eastern # #Specifies the time zone for the target MySQL-compatible database, e.g., US/Eastern, US/Pacific, UTC / remove if UTC
          secrets_manager_secret_id: arn:aws:secretsmanager:us-east-1:920268603720:secret:prd-use1-dreams-guest-secret-6E4Orw #pragma: allowlist secret, The ARN, or display name of the SecretsManagerSecret that contains the MySQL endpoint connection details.
      source_kms_key: 179d9ff2-1d6d-4fd1-b639-ee1fbeb1bc03 # Update for the secrets_manager_secret_id kms key
      source_ssl_cert: rds-global-bundle # Update for the appropriate source dms certificate, most AWS DBs will use the rds-global-bundle by default
    data_pipe:
      default_router_database: DEFAULT_ROUTER_PROD_LANDING # Needs update to appropriate default routing
      data_contracts: # This section needs to be updated for all data contracts for the source
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_cntry_source_data_contract
          class_name: DREAMSGuestCntryModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: cntry
          router_database: &database PROD_LANDING
          router_schema: &guest_schema LND_DREAMS_GUEST
          router_table: CNTRY
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_rgn_source_data_contract
          class_name: DREAMSGuestRgnModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: rgn
          router_database: *database
          router_schema: *guest_schema
          router_table: RGN
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_idvl_pty_source_data_contract
          class_name: DREAMSGuestTxnIdvlPtyModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_idvl_pty
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_IDVL_PTY
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_idvl_pty_mbshp_source_data_contract
          class_name: DREAMSGuestTxnIdvlPtyMbshpModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_idvl_pty_mbshp
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_IDVL_PTY_MBSHP
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_org_pty_source_data_contract
          class_name: DREAMSGuestTxnOrgPtyModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_org_pty
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_ORG_PTY
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_pty_source_data_contract
          class_name: DREAMSGuestTxnPtyModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_pty
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_PTY
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_pty_addr_lctr_source_data_contract
          class_name: DREAMSGuestTxnPtyAddrLctrModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_pty_addr_lctr
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_PTY_ADDR_LCTR
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_pty_eml_lctr_source_data_contract
          class_name: DREAMSGuestTxnPtyEmlLctrModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_pty_eml_lctr
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_PTY_EML_LCTR
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_pty_lctr_source_data_contract
          class_name: DREAMSGuestTxnPtyLctrModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_pty_lctr
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_PTY_LCTR
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_pty_lctr_xref_source_data_contract
          class_name: DREAMSGuestTxnPtyLctrXrefModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_pty_lctr_xref
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_PTY_LCTR_XREF
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_pty_phn_lctr_source_data_contract
          class_name: DREAMSGuestTxnPtyPhnLctrModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_pty_phn_lctr
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_PTY_PHN_LCTR
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_pty_rl_source_data_contract
          class_name: DREAMSGuestTxnPtyRlModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_pty_rl
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_PTY_RL
        #20230816
        - data_contract: app.src.data_structures.data_contracts.source.dreams.guest.v0.dreams_guest_txn_pty_extnl_ref_source_data_contract
          class_name: DREAMSGuestTxnPtyExtnlRefModel
          data_contract_version: 0.0.1
          key_path:
            - name: metadata.table-name
              value: txn_pty_extnl_ref
          router_database: *database
          router_schema: *guest_schema
          router_table: TXN_PTY_EXTNL_REF
